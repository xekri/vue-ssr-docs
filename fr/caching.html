
<!DOCTYPE HTML>
<html lang="fr" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Mise en cache · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-vuejs/vue.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="streaming.html" />
    
    
    <link rel="prev" href="head.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Tapez pour rechercher" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="basic.html">
            
                <a href="basic.html">
            
                    
                    Utilisation de base
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="universal.html">
            
                <a href="universal.html">
            
                    
                    Écrire du code universel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="structure.html">
            
                <a href="structure.html">
            
                    
                    Structure de code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="routing.html">
            
                <a href="routing.html">
            
                    
                    Routage et scission du code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="data.html">
            
                <a href="data.html">
            
                    
                    Récupération de données et état
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="hydration.html">
            
                <a href="hydration.html">
            
                    
                    Hydratation côté client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="bundle-renderer.html">
            
                <a href="bundle-renderer.html">
            
                    
                    Introduction au moteur de dépaquetage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="build-config.html">
            
                <a href="build-config.html">
            
                    
                    Configuration de pré-compilation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="css.html">
            
                <a href="css.html">
            
                    
                    Gestion des CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="head.html">
            
                <a href="head.html">
            
                    
                    Gestion des entêtes (En)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.12" data-path="caching.html">
            
                <a href="caching.html">
            
                    
                    Mise en cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="streaming.html">
            
                <a href="streaming.html">
            
                    
                    Envoi par flux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Référence de l'API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="api.html">
            
                <a href="api.html#createrendereroptions">
            
                    
                    createRenderer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="api.html">
            
                <a href="api.html#createbundlerendererbundle-options">
            
                    
                    createBundleRenderer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="api.html">
            
                <a href="api.html#class-renderer">
            
                    
                    Class: Renderer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="api.html">
            
                <a href="api.html#class-bundlerenderer">
            
                    
                    Class: BundleRenderer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="api.html">
            
                <a href="api.html#renderer-options">
            
                    
                    Options de Renderer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.5.1" data-path="api.html">
            
                <a href="api.html#template">
            
                    
                    template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.2" data-path="api.html">
            
                <a href="api.html#clientmanifest">
            
                    
                    clientManifest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.3" data-path="api.html">
            
                <a href="api.html#inject">
            
                    
                    inject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.4" data-path="api.html">
            
                <a href="api.html#shouldpreload">
            
                    
                    shouldPreload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.5" data-path="api.html">
            
                <a href="api.html#runinnewcontext">
            
                    
                    runInNewContext
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.6" data-path="api.html">
            
                <a href="api.html#basedir">
            
                    
                    basedir
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.7" data-path="api.html">
            
                <a href="api.html#cache">
            
                    
                    cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5.8" data-path="api.html">
            
                <a href="api.html#directives">
            
                    
                    directives
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="api.html">
            
                <a href="api.html#webpack-plugins">
            
                    
                    Plugins webpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Publié avec GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Mise en cache</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="mise-en-cache">Mise en cache</h1>
<p>M&#xEA;me si le SSR de Vue est tr&#xE8;s rapide, il ne peut &#xE9;galer les performances d&apos;un rendu utilisant une cha&#xEE;ne de caract&#xE8;res pure du fait du co&#xFB;t de la cr&#xE9;ation des instances de composants et des n&#x153;uds du DOM virtuel. Dans le cas ou les performances du SSR seraient critiques, il est conseill&#xE9; d&apos;utiliser une strat&#xE9;gie de mise en cache pour am&#xE9;liorer significativement le temps de r&#xE9;ponse et r&#xE9;duire la charge du serveur.</p>
<h2 id="mise-en-cache-au-niveau-de-la-page">Mise en cache au niveau de la page</h2>
<p>Une application de rendu c&#xF4;t&#xE9; serveur est, dans la plupart des cas, li&#xE9;e &#xE0; des donn&#xE9;es externes. Donc le contenu est dynamique par nature et ne peut pas &#xEA;tre mis en cache pour des p&#xE9;riodes &#xE9;tendues. Cependant, si le contenu n&apos;est pas sp&#xE9;cifique &#xE0; un utilisateur (c.-&#xE0;-d. qu&apos;un m&#xEA;me URL rend toujours un m&#xEA;me contenu ind&#xE9;pendamment des utilisateurs), nous pouvons mettre en place une strat&#xE9;gie appel&#xE9;e <a href="https://www.nginx.com/blog/benefits-of-microcaching-nginx/" target="_blank">micro-caching</a> pour am&#xE9;liorer significativement la capacit&#xE9; de notre application &#xE0; prendre en charge un fort trafique.</p>
<p>Ceci est habituellement fait au niveau de la couche nginx, mais nous pouvons &#xE9;galement l&apos;impl&#xE9;menter en Node.js :</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> microCache = LRU({
  max: <span class="hljs-number">100</span>,
  maxAge: <span class="hljs-number">1000</span> <span class="hljs-comment">// Important : les entr&#xE9;es expires apr&#xE8;s une seconde.</span>
})

<span class="hljs-keyword">const</span> isCacheable = req =&gt; {
  <span class="hljs-comment">// impl&#xE9;mentation d&apos;un algorithme pour d&#xE9;finir si une requ&#xEA;te est sp&#xE9;cifique &#xE0; un utilisateur.</span>
  <span class="hljs-comment">// seules les pages non sp&#xE9;cifiques &#xE0; un utilisateur peuvent &#xEA;tre mises en cache</span>
}

server.get(<span class="hljs-string">&apos;*&apos;</span>, (req, res) =&gt; {
  <span class="hljs-keyword">const</span> cacheable = isCacheable(req)
  <span class="hljs-keyword">if</span> (cacheable) {
    <span class="hljs-keyword">const</span> hit = microCache.get(req.url)
    <span class="hljs-keyword">if</span> (hit) {
      <span class="hljs-keyword">return</span> res.end(hit)
    }
  }

  renderer.renderToString((err, html) =&gt; {
    res.end(html)
    <span class="hljs-keyword">if</span> (cacheable) {
      microCache.set(req.url, html)
    }
  })
})
</code></pre>
<p>Parce que le composant est mis en cache pour seulement une seconde, les utilisateurs ne verront pas le contenu d&#xE9;j&#xE0; p&#xE9;rim&#xE9;. Cependant, cela signifie que le serveur a besoin de faire un rendu complet une seule fois par seconde pour chaque page mise en cache.</p>
<h2 id="mise-en-cache-au-niveau-du-composant">Mise en cache au niveau du composant</h2>
<p><code>vue-server-renderer</code> a un support int&#xE9;gr&#xE9; pour la mise en cache de composant. Pour l&apos;activer, vous avez besoin d&apos;une <a href="api.html#cache">impl&#xE9;mentation de mise en cache</a> quand vous cr&#xE9;ez le moteur de rendu. L&apos;usage courant est de passer un <a href="https://github.com/isaacs/node-lru-cache" target="_blank">objet de mise en cache qui supprime l&apos;objet le plus r&#xE9;cemment utilis&#xE9;</a> :</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> LRU = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;lru-cache&apos;</span>)

<span class="hljs-keyword">const</span> renderer = createRenderer({
  cache: LRU({
    max: <span class="hljs-number">10000</span>,
    maxAge: ...
  })
})
</code></pre>
<p>Vous pouvez aussi impl&#xE9;menter une mise en cache de composant avec une fonction <code>serverCacheKey</code> :</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  name: <span class="hljs-string">&apos;item&apos;</span>, <span class="hljs-comment">// requis</span>
  props: [<span class="hljs-string">&apos;item&apos;</span>],
  serverCacheKey: props =&gt; props.item.id,
  render (h) {
    <span class="hljs-keyword">return</span> h(<span class="hljs-string">&apos;div&apos;</span>, <span class="hljs-keyword">this</span>.item.id)
  }
}
</code></pre>
<p>Notez que ce composant pouvant &#xEA;tre mis en cache <strong>doit aussi d&#xE9;finir une option <code>name</code> unique</strong>. Avec un nom unique, la cl&#xE9; de mise en cache est effective par composant : vous n&apos;avez donc pas besoin de vous pr&#xE9;occuper de deux composants qui retourneraient la m&#xEA;me cl&#xE9;.</p>
<p>La cl&#xE9; retourn&#xE9;e par <code>serverCacheKey</code> devrait contenir suffisamment d&apos;informations pour repr&#xE9;senter tous les r&#xE9;sultats de rendu. L&apos;exemple ci-dessus est une bonne impl&#xE9;mentation si le r&#xE9;sultat du rendu est uniquement d&#xE9;termin&#xE9; par <code>props.item.id</code>. Cependant, si un &#xE9;l&#xE9;ment avec le m&#xEA;me identifiant change &#xE0; chaque fois, ou si son rendu est li&#xE9; au changement d&apos;une autre prop, alors vous devez modifier votre impl&#xE9;mentation <code>getCacheKey</code> pour prendre en compte ces variables.</p>
<p>Retourner une constante va mener le composant &#xE0; toujours &#xEA;tre en cache, ce qui peut &#xEA;tre une bonne chose pour les composants statiques.</p>
<h3 id="quand-utiliser-de-la-mise-en-cache-de-composant-">Quand utiliser de la mise en cache de composant ?</h3>
<p>Si le moteur de rendu trouve du cache pour un composant durant le rendu, il va directement utiliser ce cache comme r&#xE9;sultat pour le sous arbre de composant complet. Cela signifie qu&apos;il ne faut <strong>PAS</strong> mettre en cache un composant quand :</p>
<ul>
<li>Il poss&#xE8;de des composants enfants li&#xE9;s &#xE0; l&apos;&#xE9;tat global.</li>
<li>Il poss&#xE8;de des composants enfants qui produisent des effets de bord sur le rendu de <code>context</code>.</li>
</ul>
<p>La mise en cache de composant doit donc &#xEA;tre utilis&#xE9;e avec soin pour &#xE9;viter les goulots d&apos;&#xE9;tranglement de performance. Dans la plupart des cas, vous n&apos;en aurez pas besoin et donc pas besoin de mettre en cache les instances de composants. Les types de composants les plus communs pour de la mise en cache sont ceux utilisant de grosses listes <code>v-for</code>. Comme ces composants sont g&#xE9;n&#xE9;ralement aliment&#xE9;s par des collections de base de donn&#xE9;es, ils peuvent utiliser une simple strat&#xE9;gie de mise en cache : g&#xE9;n&#xE9;rer leur cl&#xE9; de mise en cache en utilisant leur unique identifiant associ&#xE9; &#xE0; un timestamp mis &#xE0; jour :</p>
<pre><code class="lang-js">serverCacheKey: props =&gt; props.item.id + <span class="hljs-string">&apos;::&apos;</span> + props.item.last_updated
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="head.html" class="navigation navigation-prev " aria-label="Previous page: Gestion des entêtes (En)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="streaming.html" class="navigation navigation-next " aria-label="Next page: Envoi par flux">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Mise en cache","level":"1.12","depth":1,"next":{"title":"Envoi par flux","level":"1.13","depth":1,"path":"streaming.md","ref":"streaming.md","articles":[]},"previous":{"title":"Gestion des entêtes (En)","level":"1.11","depth":1,"path":"head.md","ref":"head.md","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","theme-vuejs@git+https://github.com/pearofducks/gitbook-plugin-theme-vuejs.git","-fontsettings","github"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"edit-link":{"label":"Edit This Page","base":"https://github.com/vuejs/vue-ssr-docs/edit/master/"},"github":{"url":"https://github.com/vuejs/vue-ssr-docs/"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-vuejs":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"fr","links":{"sharing":{"facebook":false,"twitter":false}},"gitbook":"*"},"file":{"path":"caching.md","mtime":"2017-08-24T05:24:43.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-08-24T05:42:05.628Z"},"basePath":".","book":{"language":"fr"}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    </body>
</html>

